{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Tasks â€” SnoozeNot</title>
<style>
    body { background-color: #000; color: #f0f0f0; font-family: sans-serif; margin: 0; padding: 20px; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #ff6600; border-bottom: 2px solid #1e1e1e; padding-bottom: 10px; margin-bottom: 20px; }

    .task-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .task-table th, .task-table td { padding: 12px 10px; text-align: left; border-bottom: 1px solid #1e1e1e; }
    .task-table th { background-color: #1e1e1e; color: #aaaaaa; font-weight: 600; text-transform: uppercase; font-size: 0.85em; }
    .task-table tr:hover { background-color: #1a1a1a; cursor: pointer; }
    input[type="checkbox"] { accent-color: #ff6600; width: 18px; height: 18px; }

    /* Category colors */
    .status-work { color: #ff6600; font-weight: 600; }
    .status-study { color: #4aa3ff; font-weight: 600; }
    .status-personal { color: #33cc33; font-weight: 600; }

    /* Action buttons */
    .action-button { background-color: transparent; color: #ff6600; border: none; cursor: pointer; padding: 5px; font-weight: 500; text-decoration: none; }
    .action-button:hover { text-decoration: underline; }

    /* Back to dashboard button */
    .btn-back-dashboard {
        display: inline-block;
        margin-top: 30px;
        text-decoration: none;
        color: white;
        font-weight: 500;
        background-color: #ff6600;
        border: 1px solid #ff6600;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
    }

    /* Empty row styling */
    .task-table tbody td[colspan="6"] { color: #aaaaaa; text-align: center; padding: 50px; font-style: italic; }
</style>
</head>
<body>
<div class="container">
    <h1>All Tasks</h1>

    <table class="task-table">
        <thead>
            <tr>
                <th style="width: 30px;">Done</th>
                <th>Task</th>
                <th style="width: 150px;">Start Time</th>
                <th style="width: 150px;">End Time</th>
                <th style="width: 120px;">Category</th>
                <th style="width: 120px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>
                    <input type="checkbox" {% if task.completed %}checked{% endif %}>
                </td>
                <td>{{ task.title }}</td>
                <td>
                    {% with task.focus_sessions.last as latest_session %}
                        {% if latest_session %}
                            {{ latest_session.start_time|date:"M d, Y H:i" }}
                        {% else %}
                            N/A
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% with task.focus_sessions.last as latest_session %}
                        {% if latest_session %}
                            {% if latest_session.end_time %}
                                {{ latest_session.end_time|date:"M d, Y H:i" }}
eee                            {% else %}
                                <span style="color: #ff6600;">Running...</span>
                            {% endif %}
                        {% else %}
                            N/A
                        {% endif %}
                    {% endwith %}
                </td>
                <td class="status-{{ task.categories|lower }}">{{ task.categories|title }}</td>
                <td>
                    <a href="{% url 'UserAuth:todo_list' %}?edit={{ task.id }}" class="action-button">Edit</a>
                    <button class="action-button" onclick="deleteTask({{ task.id }})">Delete</button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No tasks yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{% url 'UserAuth:Dashboard' %}" class="btn-back-dashboard">Back to Dashboard</a>
</div>

<script>
function deleteTask(taskId) {
    if (!confirm('Are you sure you want to delete this task?')) return;

    fetch("{% url 'UserAuth:delete_task' 0 %}".replace('0', taskId), {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(res => res.json())
    .then(data => {
        if (data.ok) {
            location.reload();
        } else {
            alert('Failed to delete task.');
        }
    })
    .catch(err => alert('Error deleting task.'));
}
</script>

</body>
</html>